-- 일반_상품정보
SELECT DISTINCT PDC_CD, PDC_NM, PDGR_CD, PDGR_NM
	FROM FDWTTP01011
  ORDER BY 1;

-- 일반_원수_미경과보험료
SELECT RRNR_DAT_DVCD, RRNR_CTC_BZ_DVCD, NTNL_CTRY_CD, ARC_INPL_CD,
       SUM(LTPD_URND_PRM) AS LTPD_URND_PRM
	FROM FDMTAG04001
	WHERE CLG_YM = SUBSTR(:ET_PARM02,1,6)
	GROUP BY RRNR_DAT_DVCD, RRNR_CTC_BZ_DVCD, NTNL_CTRY_CD, ARC_INPL_CD;

-- 일반_출재_미경과보험료
SELECT RRNR_DAT_DVCD, RRNR_CTC_BZ_DVCD, NTNL_CTRY_CD, ARC_INPL_CD, T02_RN_RINSC_CD,
       SUM(T02_LTPD_RN_URND_PRM) AS T02_LTPD_RN_URND_PRM
	FROM FDMTAG04002
	WHERE CLG_YM = SUBSTR(:ET_PARM02,1,6)
	GROUP BY RRNR_DAT_DVCD, RRNR_CTC_BZ_DVCD, NTNL_CTRY_CD, ARC_INPL_CD, T02_RN_RINSC_CD;

-- 일반_원수_예정보험료
SELECT RRNR_DAT_DVCD, RRNR_CTC_BZ_DVCD, ARC_INPL_CD, NTNL_CTRY_CD, SUM(WNCR_CNV_EPCT_PRM) AS WNCR_CNV_EPCT_PRM
	FROM (
  	SELECT DISTINCT BSE_YM, PLNO, PYM_EPCT_DT, WNCR_CNV_EPCT_PRM
			FROM FDMTAG04003
  		WHERE BSE_YM = '201912'
      	AND PYM_YN = '0'
      	AND SUBSTR(PYM_EPCT_DT,1,6) > BSE_YM
  ) A LEFT JOIN (
  	SELECT DISTINCT PLNO, ARC_INPL_CD, RRNR_DAT_DVCD, RRNR_CTC_BZ_DVCD, NTNL_CTRY_CD
    	FROM FDMTAG04001
  ) B
  ON A.PLNO=B.PLNO
  GROUP BY RRNR_DAT_DVCD, RRNR_CTC_BZ_DVCD, ARC_INPL_CD, NTNL_CTRY_CD;

-- 일반_출재_예정보험료
WITH EPCT_RN_PRM AS (
  SELECT PLNO, T02_RN_RINSC_CD, SUM(WNCR_CNV_RN_PRM) AS WNCR_CNV_RN_PRM
    FROM FDMTAG04003
    WHERE 1=1
    	AND SUBSTR(PYM_EPCT_DT,1,6) > '201912'
      AND BSE_YM = '201912'
      AND PYM_YN = '0'
      GROUP BY PLNO, T02_RN_RINSC_CD
)

SELECT B.ARC_INPL_CD, B.RRNR_CTC_BZ_DVCD, B.RRNR_DAT_DVCD, B.NTNL_CTRY_CD, A.T02_RN_RINSC_CD, SUM(A.WNCR_CNV_RN_PRM) AS WNCR_CNV_RN_PRM
	FROM EPCT_RN_PRM A
  LEFT JOIN (SELECT DISTINCT PLNO, ARC_INPL_CD, NTNL_CTRY_CD, RRNR_DAT_DVCD, RRNR_CTC_BZ_DVCD FROM FDMTAG04002) B
  	ON A.PLNO=B.PLNO
    GROUP BY B.ARC_INPL_CD, B.RRNR_CTC_BZ_DVCD, B.RRNR_DAT_DVCD, B.NTNL_CTRY_CD, A.T02_RN_RINSC_CD
    HAVING SUM(A.WNCR_CNV_RN_PRM) != 0;

-- 일반_원수_개별추산액
SELECT RRNR_DAT_DVCD, RRNR_DMFR_DVCD, NTNL_CTRY_CD, ARC_INPL_CD,
       SUM(LTPD_OST_AMT) AS LTPD_OST_AMT
	FROM FDMTTC04001
	WHERE CLG_YM = SUBSTR(:ET_PARM02,1,6)
	GROUP BY RRNR_DAT_DVCD, RRNR_DMFR_DVCD, NTNL_CTRY_CD, ARC_INPL_CD;

-- 일반_출재_개별추산액
SELECT RRNR_DAT_DVCD, RRNR_DMFR_DVCD, NTNL_CTRY_CD, ARC_INPL_CD, T02_RN_RINSC_CD,
       SUM(RN_LTPD_OST_AMT) AS RN_LTPD_OST_AMT
	FROM FDMTTC04002
	WHERE CLG_YM = SUBSTR(:ET_PARM02,1,6)
	GROUP BY RRNR_DAT_DVCD, RRNR_DMFR_DVCD, NTNL_CTRY_CD, ARC_INPL_CD, T02_RN_RINSC_CD;

-- 일반_출재_손해조사비율
SELECT RRNR_DAT_DVCD,
		   RRNR_DMFR_DVCD,
		   ARC_INPL_CD,
       SUM(WNCR_CNV_PYN_BNF) AS WNCR_CNV_PYN_BNF,
       SUM(WNCR_CNV_RN_DAG_IVMT) AS WNCR_CNV_RN_DAG_IVMT
	FROM FDMTTC04002
  WHERE CLG_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(SUBSTR(:ET_PARM02,1,6),'YYYYMM'), -35), 'YYYYMM') AND SUBSTR(:ET_PARM02,1,6)
  GROUP BY RRNR_DAT_DVCD, RRNR_DMFR_DVCD, ARC_INPL_CD;

-- 일반_보험금진전추이
SELECT PDGR_CD, AY, BASE_1, BASE_2, BASE_3, BASE_4, BASE_5, BASE_6, BASE_7
	FROM KICS_RISK_CF_NL_G WHERE BSE_YM = '201912';

-- 일반_최종손해율
SELECT RRNR_DAT_DVCD, PDGR_CD, FNAL_LSRT
	FROM FBMTST12201
  WHERE BSE_YM = '201812'
  	AND SQNO = '1';

-- 할인율
SELECT KICS_SCEN_NO, MAT_TERM, SPOT_RATE
	FROM KICS_USER_FSS_SCENARIO
	WHERE FSS_SCEN_TYP = '3100'
		AND BSE_YM = '201912';

-- 국가그룹
SELECT CNTR_CD, CNTR_CATG_CD, CNTR_CD_NM
	FROM KICS_CNTR_GRP_MAP_NL
	WHERE APLY_END_DATE = '21991231';
----------------------------------------------------------------------

---- 일반_원수_미경과보험료
--SELECT CLG_YM,
--       RRNR_DAT_DVCD,
--	     INRI_RN_KND_CD,
--       DECODE(RRNR_CTC_BZ_DVCD,'3','KR',DECODE(PDC_CD, '10900', 'US', NTNL_CTRY_CD)) AS NTNL_CTRY_CD,
--       SUBSTR(ARC_INPL_CD, 1, 5) AS PDC_CD,
--       SUM(LTPD_URND_PRM) AS LTPD_URND_PRM
--	FROM FDMTAG04001
--  WHERE CLG_YM = '202012'
--  GROUP BY
--       CLG_YM,
--       RRNR_DAT_DVCD,
--       INRI_RN_KND_CD,
--       DECODE(RRNR_CTC_BZ_DVCD,'3','KR',DECODE(PDC_CD, '10900', 'US', NTNL_CTRY_CD)),
--       SUBSTR(ARC_INPL_CD, 1, 5);
--
---- 일반_출재_미경과보험료
--SELECT CLG_YM,
--       RRNR_DAT_DVCD,
--       RN_KND_CD,
--       DECODE(RRNR_CTC_BZ_DVCD,'3','KR',DECODE(PDC_CD, '10900', 'US', NTNL_CTRY_CD)) AS NTNL_CTRY_CD,
--       SUBSTR(ARC_INPL_CD, 1, 5) AS PDC_CD,
--       T02_RN_RINSC_CD,
--       SUM(T02_LTPD_RN_URND_PRM) AS T02_LTPD_RN_URND_PRM
--	FROM FDMTAG04002
--  WHERE CLG_YM = '202012'
--  GROUP BY
--       CLG_YM,
--       RRNR_DAT_DVCD,
--       RN_KND_CD,
--       DECODE(RRNR_CTC_BZ_DVCD,'3','KR',DECODE(PDC_CD, '10900', 'US', NTNL_CTRY_CD)),
--       SUBSTR(ARC_INPL_CD, 1, 5),
--       T02_RN_RINSC_CD;

---- 일반_원수_납입예정보험료
---- PLNO → PDC_CD UNIQUENESS CHECK
-------------------------------------
--SELECT PLNO
--	FROM (
--  	SELECT DISTINCT PLNO, SUBSTR(ARC_INPL_CD,1,5) AS PDC_CD, NTNL_CTRY_CD
--		  FROM FDMTAG04001
--      WHERE PLNO IN (SELECT PLNO FROM FDMTAG04003)
--  )
--  GROUP BY PLNO
--  HAVING COUNT(*) > 1;
-------------------------------------
--SELECT BSE_YM, NTNL_CTRY_CD, PDC_CD, T02_RN_RINSC_CD, SUM(WNCR_CNV_EPCT_PRM) AS WNCR_CNV_EPCT_PRM
--	FROM (
--  	SELECT DISTINCT BSE_YM, PLNO, PYM_EPCT_DT, T02_RN_RINSC_CD, WNCR_CNV_EPCT_PRM
--			FROM FDMTAG04003
--  		WHERE BSE_YM = '202012'
--      	AND PYM_YN = '0'
--      	AND SUBSTR(PYM_EPCT_DT,1,6) > BSE_YM
--  ) A LEFT JOIN (
--  	SELECT DISTINCT PLNO, SUBSTR(ARC_INPL_CD, 1, 5) AS PDC_CD, DECODE(PDC_CD, '10900', 'US', NTNL_CTRY_CD) AS NTNL_CTRY_CD
--    	FROM FDMTAG04001
--  ) B
--  ON A.PLNO=B.PLNO
--  GROUP BY BSE_YM, NTNL_CTRY_CD, PDC_CD, T02_RN_RINSC_CD;
--
---- 일반_출재_납입예정보험료
--SELECT BSE_YM, NTNL_CTRY_CD, PDC_CD, T02_RN_RINSC_CD, SUM(WNCR_CNV_RN_PRM) AS WNCR_CNV_RN_PRM
--	FROM (
--  	SELECT BSE_YM, PLNO, T02_RN_RINSC_CD, SUM(WNCR_CNV_RN_PRM) AS WNCR_CNV_RN_PRM
--			FROM FDMTAG04003
--  		WHERE BSE_YM = '202012'
--      	AND PYM_YN = '0'
--  		GROUP BY BSE_YM, PLNO, T02_RN_RINSC_CD
--  ) A LEFT JOIN (
--  	SELECT DISTINCT PLNO, SUBSTR(ARC_INPL_CD, 1, 5) AS PDC_CD, DECODE(PDC_CD, '10900', 'US', NTNL_CTRY_CD) AS NTNL_CTRY_CD
--    	FROM FDMTAG04001
--  ) B
--  ON A.PLNO=B.PLNO
--  GROUP BY BSE_YM, NTNL_CTRY_CD, PDC_CD, T02_RN_RINSC_CD;

-- 일반_납입예정보험료 (수정예정)
SELECT BSE_YM, PYM_EPCT_YM, NTNL_CTRY_CD, PDC_CD, T02_RN_RINSC_CD, SUM(WNCR_CNV_EPCT_PRM) AS WNCR_CNV_EPCT_PRM, SUM(WNCR_CNV_RN_PRM) AS WNCR_CNV_RN_PRM
	FROM (
  	SELECT BSE_YM, PLNO, SUBSTR(PYM_EPCT_DT, 1, 6) AS PYM_EPCT_YM, T02_RN_RINSC_CD, SUM(WNCR_CNV_EPCT_PRM) AS WNCR_CNV_EPCT_PRM, SUM(WNCR_CNV_RN_PRM) AS WNCR_CNV_RN_PRM
			FROM FDMTAG04003
  		WHERE BSE_YM = '202012'
      	AND PYM_YN = '0'
  		GROUP BY BSE_YM, PLNO, SUBSTR(PYM_EPCT_DT, 1, 6), T02_RN_RINSC_CD
  ) A LEFT JOIN (
  	SELECT DISTINCT PLNO, SUBSTR(ARC_INPL_CD, 1, 5) AS PDC_CD, DECODE(RRNR_CTC_BZ_DVCD,'3','KR',DECODE(PDC_CD, '10900', 'US', NTNL_CTRY_CD)) AS NTNL_CTRY_CD
    	FROM FDMTAG04001
  ) B
  ON A.PLNO=B.PLNO
  GROUP BY BSE_YM, PYM_EPCT_YM, NTNL_CTRY_CD, PDC_CD, T02_RN_RINSC_CD;

-- 일반_원수_손해조사비율
SELECT '202012' AS CLG_YM,
       RRNR_DAT_DVCD,
	     INRI_RN_KND_CD,
       DECODE(RRNR_DMFR_DVCD,'1','KR',DECODE(PDC_CD, '10900', 'US', NTNL_CTRY_CD)) AS NTNL_CTRY_CD,
       SUBSTR(ARC_INPL_CD, 1, 5) AS PDC_CD,
       SUM(OGL_PYN_BNF) AS OGL_PYN_BNF,
       SUM(ACCD_IVMT) AS ACCD_IVMT
	FROM FDMTTC04001
  WHERE CLG_YM BETWEEN '201801' AND '202012'
  GROUP BY
       RRNR_DAT_DVCD,
       INRI_RN_KND_CD,
       DECODE(RRNR_DMFR_DVCD,'1','KR',DECODE(PDC_CD, '10900', 'US', NTNL_CTRY_CD)),
       SUBSTR(ARC_INPL_CD, 1, 5);

-- 일반_출재_손해조사비율
SELECT '202012' AS CLG_YM,
       RRNR_DAT_DVCD,
       RN_KND_CD,
       DECODE(RRNR_DMFR_DVCD,'1','KR',DECODE(PDC_CD, '10900', 'US', NTNL_CTRY_CD)) AS NTNL_CTRY_CD,
       SUBSTR(ARC_INPL_CD, 1, 5) AS PDC_CD,
       T02_RN_RINSC_CD,
       SUM(WNCR_CNV_PYN_BNF) AS WNCR_CNV_PYN_BNF,
       SUM(WNCR_CNV_RN_DAG_IVMT) AS WNCR_CNV_RN_DAG_IVMT
	FROM FDMTTC04002
  WHERE CLG_YM = '202012'
  GROUP BY
       RRNR_DAT_DVCD,
       RN_KND_CD,
       DECODE(RRNR_DMFR_DVCD,'1','KR',DECODE(PDC_CD, '10900', 'US', NTNL_CTRY_CD)),
       SUBSTR(ARC_INPL_CD, 1, 5),
       T02_RN_RINSC_CD;

-- 일반_IBNR
SELECT CLG_YM
     , RRNR_DVCD
     , IBNR_KEY
     , NVL(SUM(KRW_OS_AMT_E),0) AS KRW_OS_AMT_E
	FROM (
	SELECT TO_CHAR(AS_OF_DATE,'YYYYMM') AS CLG_YM
	   , CASE WHEN FUND_TYP_CD='10' THEN '01'
	          WHEN FUND_TYP_CD='11' THEN '02'
	          WHEN FUND_TYP_CD='12' THEN '03' END AS RRNR_DVCD
	   , CASE WHEN SUBSTR(FCONT_ID,6,4)='2_32' THEN '2'
	          ELSE SUBSTR(FCONT_ID,6,4) END AS IBNR_KEY
	   , KRW_OS_AMT_E
	FROM Q_CB_INST_NLG_LIC_IBNR
	WHERE TO_CHAR(AS_OF_DATE,'YYYYMM') = '201912'
 )
 GROUP BY CLG_YM
     , RRNR_DVCD
     , IBNR_KEY
 ORDER BY 2, 3
;

-- 일반_보험금진전추이
-- ※ SQNO 여러개 아닌지 확인 후 뽑을 것!
SELECT BSE_YM, PDGR_CD, AY, BASE_1,BASE_2, BASE_3, BASE_4, BASE_5, BASE_6, BASE_7
	FROM KICS_RISK_CF_NL_G WHERE BSE_YM = '202012';

-- 일반_특약정보
--SELECT RRNR_TTY_CD,
--			 TTY_CD_NM,
--       DECODE(CMSN_DVCD, '1', 'V', 'F') AS CMSN_DVCD,
--       DECODE(RRNR_TTY_RN_TPCD, 'X', 'P', CASE WHEN TTY_CD_NM LIKE '%KEITI%' THEN 'P' ELSE 'NP' END) AS PROP_NOT_PROP_DVCD
--	FROM FDWTAG04107;

-- 일반_특약정보
SELECT RRNR_TTY_CD
     , TTY_CD_NM
     , RRNR_TTY_RN_TPCD
     , RRNR_TAGR_CD
     , CMSN_DVCD
	FROM FDWTAG04107;

-- 일반_국가구분
SELECT CNTR_CD, CNTR_CD_NM, KICS_CNTR_CATG_NM
	FROM (
  	SELECT CNTR_CATG_CD, CNTR_CD, CNTR_CD_NM
			FROM KICS_CNTR_GRP_MAP_NL
    ) a LEFT JOIN (
  	SELECT CNTR_CATG_CD, KICS_CNTR_CATG_NM
    	FROM KICS_CNTR_GRP_NL
    ) b
  	ON a.CNTR_CATG_CD = b.CNTR_CATG_CD;

-- 일반_최종손해율
-- ※ SQNO 여러개 아닌지 확인 후 뽑을 것!
SELECT BSE_YM, RRNR_DAT_DVCD, PDGR_CD, FNAL_LSRT
	FROM FBMTST12201
  WHERE BSE_YM = '201912'
  ORDER BY 2, 3;

-- 일반_사업비율
-- ※ 소스확인 후 수정필요!
--SELECT *
--	FROM Q_SY_CODE_SPEC
--	WHERE CODE_ID = 'BOZ_CD';
SELECT DISTINCT BASE_DATE
     , CASE WHEN RRNR_DVCD IN ('01','02') THEN '04'
            WHEN RRNR_DVCD IN ('03') THEN '03'
            END AS  RRNR_DVCD
     , DMFR_DVCD
     , BOZ_CD
     , EXP_RT
FROM KICS_PRM_RPT
WHERE TO_CHAR(BASE_DATE,'YYYYMM')='201912'
	AND SUBSTR(BOZ_CD, 0, 1) = 'A'
ORDER BY 1,2,4,3;

---------------------------------------------------------------------------------------------------------------
-- 수수료연동구분, (출재)비례비비례구분포함
-- 증권 스캔 시 출재 데이터 전체를 스캔하는 것이 더 안전하나 시간소요 과다로 동일 기간에 대해서만 스캔

-- 일반_원수_직전1년경과보험료
WITH REINS_TTY_DVCD AS (
	SELECT RRNR_TTY_CD,
         TTY_CD_NM,
         DECODE(CMSN_DVCD, '1', 'V', 'NV') AS CMSN_DVCD,
         DECODE(RRNR_TTY_RN_TPCD, 'X', 'NP', CASE WHEN TTY_CD_NM LIKE '%KEITI%' THEN 'NP' ELSE 'P' END) AS PROP_NOT_PROP_DVCD
	  FROM FDWTAG04107
)

SELECT '202012' AS CLG_YM,
       RRNR_DAT_DVCD,
	     INRI_RN_KND_CD,
       DECODE(RRNR_CTC_BZ_DVCD,'3','KR',DECODE(PDC_CD, '10900', 'US', NTNL_CTRY_CD)) AS NTNL_CTRY_CD,
       SUBSTR(ARC_INPL_CD, 1, 5) AS PDC_CD,
       CASE WHEN PLNO IN (
       		SELECT PLNO
        		FROM FDMTAG04002
        		WHERE CLG_YM BETWEEN '202001' AND '202012'
          		AND RRNR_TTY_CD IN (SELECT RRNR_TTY_CD FROM REINS_TTY_DVCD WHERE CMSN_DVCD = 'V')
       ) THEN 'V' ELSE 'NV' END AS CMSN_DVCD,
       SUM(ELP_PRM) AS ELP_PRM
	FROM FDMTAG04001
  WHERE CLG_YM BETWEEN '202001' AND '202012'
  GROUP BY
       RRNR_DAT_DVCD,
       INRI_RN_KND_CD,
       DECODE(RRNR_CTC_BZ_DVCD,'3','KR',DECODE(PDC_CD, '10900', 'US', NTNL_CTRY_CD)),
       SUBSTR(ARC_INPL_CD, 1, 5),
       CASE WHEN PLNO IN (
       		SELECT PLNO
        		FROM FDMTAG04002
        		WHERE CLG_YM BETWEEN '202001' AND '202012'
          		AND RRNR_TTY_CD IN (SELECT RRNR_TTY_CD FROM REINS_TTY_DVCD WHERE CMSN_DVCD = 'V')
       ) THEN 'V' ELSE 'NV' END;

-- 일반_출재_직전1년경과보험료
WITH REINS_TTY_DVCD AS (
	SELECT RRNR_TTY_CD,
         TTY_CD_NM,
         DECODE(CMSN_DVCD, '1', 'V', 'NV') AS CMSN_DVCD,
         DECODE(RRNR_TTY_RN_TPCD, 'X', 'NP', CASE WHEN TTY_CD_NM LIKE '%KEITI%' THEN 'NP' ELSE 'P' END) AS PROP_NOT_PROP_DVCD
	  FROM FDWTAG04107
)

SELECT '202012' AS CLG_YM,
       RRNR_DAT_DVCD,
       DECODE(RRNR_CTC_BZ_DVCD,'3','KR',DECODE(PDC_CD, '10900', 'US', NTNL_CTRY_CD)) AS NTNL_CTRY_CD,
       SUBSTR(ARC_INPL_CD, 1, 5) AS PDC_CD,
       T02_RN_RINSC_CD,
       CASE WHEN RRNR_TTY_CD IN (
       	  SELECT RRNR_TTY_CD FROM REINS_TTY_DVCD WHERE CMSN_DVCD = 'V'
       ) THEN 'V' ELSE 'NV' END AS CMSN_DVCD,
       CASE WHEN RRNR_TTY_CD IN (
       	  SELECT RRNR_TTY_CD FROM REINS_TTY_DVCD WHERE PROP_NOT_PROP_DVCD = 'NP'
       ) THEN 'NP' ELSE 'P' END AS PROP_NOT_PROP_DVCD,
       SUM(T02_RN_ELP_PRM) AS T02_RN_ELP_PRM
	FROM FDMTAG04002
  WHERE CLG_YM BETWEEN '202001' AND '202012'
  GROUP BY
       RRNR_DAT_DVCD,
       DECODE(RRNR_CTC_BZ_DVCD,'3','KR',DECODE(PDC_CD, '10900', 'US', NTNL_CTRY_CD)),
       SUBSTR(ARC_INPL_CD, 1, 5),
       T02_RN_RINSC_CD,
       CASE WHEN RRNR_TTY_CD IN (
       	  SELECT RRNR_TTY_CD FROM REINS_TTY_DVCD WHERE CMSN_DVCD = 'V'
       ) THEN 'V' ELSE 'NV' END,
       CASE WHEN RRNR_TTY_CD IN (
       	  SELECT RRNR_TTY_CD FROM REINS_TTY_DVCD WHERE PROP_NOT_PROP_DVCD = 'NP'
       ) THEN 'NP' ELSE 'P' END;

-- 일반_원수_개별추산액
WITH REINS_TTY_DVCD AS (
	SELECT RRNR_TTY_CD,
         TTY_CD_NM,
         DECODE(CMSN_DVCD, '1', 'V', 'NV') AS CMSN_DVCD,
         DECODE(RRNR_TTY_RN_TPCD, 'X', 'NP', CASE WHEN TTY_CD_NM LIKE '%KEITI%' THEN 'NP' ELSE 'P' END) AS PROP_NOT_PROP_DVCD
	  FROM FDWTAG04107
)

SELECT CLG_YM,
       RRNR_DAT_DVCD,
	     INRI_RN_KND_CD,
       DECODE(RRNR_DMFR_DVCD,'1','KR',DECODE(PDC_CD, '10900', 'US', NTNL_CTRY_CD)) AS NTNL_CTRY_CD,
       SUBSTR(ARC_INPL_CD, 1, 5) AS PDC_CD,
       CASE WHEN PLNO IN (
       		SELECT PLNO
        		FROM FDMTAG04002
        		WHERE CLG_YM = '202012'
          		AND RRNR_TTY_CD IN (SELECT RRNR_TTY_CD FROM REINS_TTY_DVCD WHERE CMSN_DVCD = 'V')
       ) THEN 'V' ELSE 'NV' END AS CMSN_DVCD,
       SUM(LTPD_OST_AMT) AS LTPD_OST_AMT
	FROM FDMTTC04001
  WHERE CLG_YM = '202012'
  GROUP BY
       CLG_YM,
       RRNR_DAT_DVCD,
       INRI_RN_KND_CD,
       DECODE(RRNR_DMFR_DVCD,'1','KR',DECODE(PDC_CD, '10900', 'US', NTNL_CTRY_CD)),
       SUBSTR(ARC_INPL_CD, 1, 5),
       CASE WHEN PLNO IN (
       		SELECT PLNO
        		FROM FDMTAG04002
        		WHERE CLG_YM = '202012'
          		AND RRNR_TTY_CD IN (SELECT RRNR_TTY_CD FROM REINS_TTY_DVCD WHERE CMSN_DVCD = 'V')
       ) THEN 'V' ELSE 'NV' END;

-- 일반_출재_개별추산액
WITH REINS_TTY_DVCD AS (
	SELECT RRNR_TTY_CD,
         TTY_CD_NM,
         DECODE(CMSN_DVCD, '1', 'V', 'NV') AS CMSN_DVCD,
         DECODE(RRNR_TTY_RN_TPCD, 'X', 'NP', CASE WHEN TTY_CD_NM LIKE '%KEITI%' THEN 'NP' ELSE 'P' END) AS PROP_NOT_PROP_DVCD
	  FROM FDWTAG04107
)

SELECT CLG_YM,
       RRNR_DAT_DVCD,
       DECODE(RRNR_DMFR_DVCD,'1','KR',DECODE(PDC_CD, '10900', 'US', NTNL_CTRY_CD)) AS NTNL_CTRY_CD,
       SUBSTR(ARC_INPL_CD, 1, 5) AS PDC_CD,
       T02_RN_RINSC_CD,
       CASE WHEN RRNR_TTY_CD IN (
       	  SELECT RRNR_TTY_CD FROM REINS_TTY_DVCD WHERE CMSN_DVCD = 'V'
       ) THEN 'V' ELSE 'NV' END AS CMSN_DVCD,
       CASE WHEN RRNR_TTY_CD IN (
       	  SELECT RRNR_TTY_CD FROM REINS_TTY_DVCD WHERE PROP_NOT_PROP_DVCD = 'NP'
       ) THEN 'NP' ELSE 'P' END AS PROP_NOT_PROP_DVCD,
       SUM(RN_LTPD_OST_AMT) AS RN_LTPD_OST_AMT
	FROM FDMTTC04002
  WHERE CLG_YM = '202012'
  GROUP BY
  		 CLG_YM,
       RRNR_DAT_DVCD,
       DECODE(RRNR_DMFR_DVCD,'1','KR',DECODE(PDC_CD, '10900', 'US', NTNL_CTRY_CD)),
       SUBSTR(ARC_INPL_CD, 1, 5),
       T02_RN_RINSC_CD,
       CASE WHEN RRNR_TTY_CD IN (
       	  SELECT RRNR_TTY_CD FROM REINS_TTY_DVCD WHERE CMSN_DVCD = 'V'
       ) THEN 'V' ELSE 'NV' END,
       CASE WHEN RRNR_TTY_CD IN (
       	  SELECT RRNR_TTY_CD FROM REINS_TTY_DVCD WHERE PROP_NOT_PROP_DVCD = 'NP'
       ) THEN 'NP' ELSE 'P' END;


-- 일반_원수_미경과보험료
WITH REINS_TTY_DVCD AS (
	SELECT RRNR_TTY_CD,
         TTY_CD_NM,
         DECODE(CMSN_DVCD, '1', 'V', 'NV') AS CMSN_DVCD,
         DECODE(RRNR_TTY_RN_TPCD, 'X', 'NP', CASE WHEN TTY_CD_NM LIKE '%KEITI%' THEN 'NP' ELSE 'P' END) AS PROP_NOT_PROP_DVCD
	  FROM FDWTAG04107
)

SELECT CLG_YM,
       RRNR_DAT_DVCD,
	     INRI_RN_KND_CD,
       DECODE(RRNR_CTC_BZ_DVCD,'3','KR',DECODE(PDC_CD, '10900', 'US', NTNL_CTRY_CD)) AS NTNL_CTRY_CD,
       SUBSTR(ARC_INPL_CD, 1, 5) AS PDC_CD,
       CASE WHEN PLNO IN (
       		SELECT PLNO
        		FROM FDMTAG04002
        		WHERE CLG_YM = '202012'
          		AND RRNR_TTY_CD IN (SELECT RRNR_TTY_CD FROM REINS_TTY_DVCD WHERE CMSN_DVCD = 'V')
       ) THEN 'V' ELSE 'NV' END AS CMSN_DVCD,
       SUM(LTPD_URND_PRM) AS LTPD_URND_PRM
	FROM FDMTAG04001
  WHERE CLG_YM = '202012'
  GROUP BY
       CLG_YM,
       RRNR_DAT_DVCD,
       INRI_RN_KND_CD,
       DECODE(RRNR_CTC_BZ_DVCD,'3','KR',DECODE(PDC_CD, '10900', 'US', NTNL_CTRY_CD)),
       SUBSTR(ARC_INPL_CD, 1, 5),
       CASE WHEN PLNO IN (
       		SELECT PLNO
        		FROM FDMTAG04002
        		WHERE CLG_YM = '202012'
          		AND RRNR_TTY_CD IN (SELECT RRNR_TTY_CD FROM REINS_TTY_DVCD WHERE CMSN_DVCD = 'V')
       ) THEN 'V' ELSE 'NV' END;


-- 일반_출재_미경과보험료
WITH REINS_TTY_DVCD AS (
	SELECT RRNR_TTY_CD,
         TTY_CD_NM,
         DECODE(CMSN_DVCD, '1', 'V', 'NV') AS CMSN_DVCD,
         DECODE(RRNR_TTY_RN_TPCD, 'X', 'NP', CASE WHEN TTY_CD_NM LIKE '%KEITI%' THEN 'NP' ELSE 'P' END) AS PROP_NOT_PROP_DVCD
	  FROM FDWTAG04107
)

SELECT CLG_YM,
       RRNR_DAT_DVCD,
       DECODE(RRNR_CTC_BZ_DVCD,'3','KR',DECODE(PDC_CD, '10900', 'US', NTNL_CTRY_CD)) AS NTNL_CTRY_CD,
       SUBSTR(ARC_INPL_CD, 1, 5) AS PDC_CD,
       T02_RN_RINSC_CD,
       CASE WHEN RRNR_TTY_CD IN (
       	  SELECT RRNR_TTY_CD FROM REINS_TTY_DVCD WHERE CMSN_DVCD = 'V'
       ) THEN 'V' ELSE 'NV' END AS CMSN_DVCD,
       CASE WHEN RRNR_TTY_CD IN (
       	  SELECT RRNR_TTY_CD FROM REINS_TTY_DVCD WHERE PROP_NOT_PROP_DVCD = 'NP'
       ) THEN 'NP' ELSE 'P' END AS PROP_NOT_PROP_DVCD,
       SUM(T02_LTPD_RN_URND_PRM) AS T02_LTPD_RN_URND_PRM
	FROM FDMTAG04002
  WHERE CLG_YM = '202012'
  GROUP BY
  		 CLG_YM,
       RRNR_DAT_DVCD,
       DECODE(RRNR_CTC_BZ_DVCD,'3','KR',DECODE(PDC_CD, '10900', 'US', NTNL_CTRY_CD)),
       SUBSTR(ARC_INPL_CD, 1, 5),
       T02_RN_RINSC_CD,
       CASE WHEN RRNR_TTY_CD IN (
       	  SELECT RRNR_TTY_CD FROM REINS_TTY_DVCD WHERE CMSN_DVCD = 'V'
       ) THEN 'V' ELSE 'NV' END,
       CASE WHEN RRNR_TTY_CD IN (
       	  SELECT RRNR_TTY_CD FROM REINS_TTY_DVCD WHERE PROP_NOT_PROP_DVCD = 'NP'
       ) THEN 'NP' ELSE 'P' END;