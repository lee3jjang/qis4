-- 일반_특약보종별_직전1년경과보험료
SELECT C.RRNR_TTY_CD, C.ARC_INPL_CD, SUM(D.ELP_PRM) ELP_PRM, SUM(C.T02_RN_ELP_PRM) AS T02_RN_ELP_PRM
	FROM (
					SELECT PLNO, RRNR_TTY_CD, ARC_INPL_CD, SUM(T02_RN_ELP_PRM) AS T02_RN_ELP_PRM
						FROM FDMTAG04002 A
						WHERE EXISTS (
							SELECT 1
								FROM FDWTAG04107 B
								WHERE B.CMSN_DVCD = '1'
							  	AND B.TTY_YR BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(:ET_PARM02, 'YYYYMMDD'),-83),'YYYY') AND SUBSTR(:ET_PARM02,1,4)
							  	AND A.RRNR_TTY_CD = B.RRNR_TTY_CD
							)
							AND CLG_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(:ET_PARM02, 'YYYYMMDD'),-11),'YYYYMM') AND SUBSTR(:ET_PARM02,1,6)
						GROUP BY PLNO, RRNR_TTY_CD, ARC_INPL_CD
			 ) C LEFT OUTER JOIN (
					SELECT PLNO, SUM(ELP_PRM) AS ELP_PRM
					  FROM FDMTAG04001
					  WHERE CLG_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(:ET_PARM02, 'YYYYMMDD'),-11),'YYYYMM') AND SUBSTR(:ET_PARM02,1,6)
					  GROUP BY PLNO
			 ) D
		ON C.PLNO=D.PLNO
	GROUP BY C.RRNR_TTY_CD, C.ARC_INPL_CD;


	-- 일반_특약보종별_직전1년손해액
	SELECT C.RRNR_TTY_CD, C.ARC_INPL_CD,
	       SUM(C.WNCR_CNV_PYN_BNF) AS WNCR_CNV_PYN_BNF, SUM(C.RN_LTPD_OST_AMT) AS RN_LTPD_OST_AMT, SUM(C.RN_PTRM_OST_AMT) AS RN_PTRM_OST_AMT, SUM(C.WNCR_CNV_RN_DAG_IVMT) AS WNCR_CNV_RN_DAG_IVMT,
	       SUM(D.OGL_PYN_BNF) AS OGL_PYN_BNF, SUM(D.LTPD_OST_AMT) AS LTPD_OST_AMT, SUM(D.PTRM_OST_AMT) AS PTRM_OST_AMT, SUM(D.ACCD_IVMT) AS ACCD_IVMT
		FROM (
						SELECT PLNO, RRNR_TTY_CD, ARC_INPL_CD, SUM(WNCR_CNV_PYN_BNF) AS WNCR_CNV_PYN_BNF, SUM(RN_LTPD_OST_AMT) AS RN_LTPD_OST_AMT, SUM(RN_PTRM_OST_AMT) AS RN_PTRM_OST_AMT, SUM(WNCR_CNV_RN_DAG_IVMT) AS WNCR_CNV_RN_DAG_IVMT
							FROM FDMTTC04002 A
							WHERE EXISTS (
									SELECT 1
										FROM FDWTAG04107 B
										WHERE B.CMSN_DVCD = '1'
									  	AND B.TTY_YR BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(:ET_PARM02, 'YYYYMMDD'),-83),'YYYY') AND SUBSTR(:ET_PARM02,1,4)
									  	AND A.RRNR_TTY_CD = B.RRNR_TTY_CD
									)
								AND CLG_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(:ET_PARM02, 'YYYYMMDD'),-11),'YYYYMM') AND SUBSTR(:ET_PARM02,1,6)
							GROUP BY PLNO, RRNR_TTY_CD, ARC_INPL_CD
				 ) C LEFT OUTER JOIN (
						SELECT PLNO, SUM(OGL_PYN_BNF) AS OGL_PYN_BNF, SUM(LTPD_OST_AMT) AS LTPD_OST_AMT, SUM(PTRM_OST_AMT) AS PTRM_OST_AMT, SUM(ACCD_IVMT) AS ACCD_IVMT
						  FROM FDMTTC04001
						  WHERE CLG_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(:ET_PARM02, 'YYYYMMDD'),-11),'YYYYMM') AND SUBSTR(:ET_PARM02,1,6)
						  GROUP BY PLNO
				 ) D
			ON C.PLNO=D.PLNO
		GROUP BY C.RRNR_TTY_CD, C.ARC_INPL_CD;


-- 일반_특약정보
SELECT RRNR_TTY_CD, TTY_CD_NM, TTY_YR
	FROM FDWTAG04107
	WHERE CMSN_DVCD = '1'
  	AND TTY_YR BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(:ET_PARM02, 'YYYYMMDD'),-83),'YYYY') AND SUBSTR(:ET_PARM02,1,4);


-- 일반_원수_손해액
SELECT CLG_YM, ARC_INPL_CD, SUM(OGL_PYN_BNF) AS OGL_PYN_BNF, SUM(LTPD_OST_AMT) AS LTPD_OST_AMT, SUM(PTRM_OST_AMT) AS PTRM_OST_AMT, SUM(ACCD_IVMT) AS ACCD_IVMT
	FROM FDMTTC04001
	WHERE CLG_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(:ET_PARM02, 'YYYYMMDD'),-35),'YYYYMM') AND SUBSTR(:ET_PARM02,1,6)
	GROUP BY CLG_YM, ARC_INPL_CD;


-- 일반_출재_손해액
SELECT CLG_YM, ARC_INPL_CD, SUM(WNCR_CNV_PYN_BNF) AS WNCR_CNV_PYN_BNF, SUM(RN_LTPD_OST_AMT) AS RN_LTPD_OST_AMT, SUM(RN_PTRM_OST_AMT) AS RN_PTRM_OST_AMT, SUM(WNCR_CNV_RN_DAG_IVMT) AS WNCR_CNV_RN_DAG_IVMT
  FROM FDMTTC04002
  WHERE CLG_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(:ET_PARM02, 'YYYYMMDD'),-35),'YYYYMM') AND SUBSTR(:ET_PARM02,1,6)
  GROUP BY CLG_YM, ARC_INPL_CD;


-- 일반_원수_경과보험료
SELECT CLG_YM, ARC_INPL_CD, SUM(ELP_PRM) AS ELP_PRM
  FROM FDMTAG04001
  WHERE CLG_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(:ET_PARM02, 'YYYYMMDD'),-35),'YYYYMM') AND SUBSTR(:ET_PARM02,1,6)
  GROUP BY CLG_YM, ARC_INPL_CD;


-- 일반_출재_경과보험료
SELECT CLG_YM, ARC_INPL_CD, SUM(T02_RN_ELP_PRM) AS T02_RN_ELP_PRM
  FROM FDMTAG04002
  WHERE CLG_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(:ET_PARM02, 'YYYYMMDD'),-35),'YYYYMM') AND SUBSTR(:ET_PARM02,1,6)
  GROUP BY CLG_YM, ARC_INPL_CD;
