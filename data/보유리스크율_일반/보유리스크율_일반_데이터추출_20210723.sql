-- 일반_특약보종별_직전1년경과보험료
SELECT D.RRNR_DAT_DVCD, D.RRNR_CTC_BZ_DVCD, D.PDC_CD, C.RRNR_TTY_CD,
	     SUM(D.ELP_PRM) AS ELP_PRM,
	     SUM(C.T02_RN_ELP_PRM) AS RN_ELP_PRM
	FROM (
					SELECT PLNO, RRNR_TTY_CD, SUM(T02_RN_ELP_PRM) AS T02_RN_ELP_PRM
						FROM FDMTAG04002 A
						WHERE EXISTS (
							SELECT 1
								FROM FDWTAG04107 B
								WHERE B.CMSN_DVCD = '1'
							  	AND B.TTY_YR BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(:ET_PARM02, 'YYYYMMDD'),-83),'YYYY') AND SUBSTR(:ET_PARM02,1,4)
							  	AND A.RRNR_TTY_CD = B.RRNR_TTY_CD
							)
							AND CLG_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(:ET_PARM02, 'YYYYMMDD'),-11),'YYYYMM') AND SUBSTR(:ET_PARM02,1,6)
						GROUP BY PLNO, RRNR_TTY_CD
			 ) C LEFT OUTER JOIN (
					SELECT PLNO, RRNR_DAT_DVCD, RRNR_CTC_BZ_DVCD, SUBSTR(ARC_INPL_CD,1,5) AS PDC_CD, SUM(ELP_PRM) AS ELP_PRM
					  FROM FDMTAG04001
					  WHERE CLG_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(:ET_PARM02, 'YYYYMMDD'),-11),'YYYYMM') AND SUBSTR(:ET_PARM02,1,6)
					  GROUP BY PLNO, RRNR_DAT_DVCD, RRNR_CTC_BZ_DVCD, SUBSTR(ARC_INPL_CD,1,5)
			 ) D
		ON C.PLNO = D.PLNO
	GROUP BY D.RRNR_DAT_DVCD, D.RRNR_CTC_BZ_DVCD, D.PDC_CD, C.RRNR_TTY_CD;

	-- 일반_특약보종별_직전1년손해액
	SELECT D.RRNR_DAT_DVCD, D.RRNR_DMFR_DVCD, D.PDC_CD, C.RRNR_TTY_CD,
	       SUM(D.OGL_LOSS) AS OGL_LOSS,
	       SUM(C.RN_LOSS) AS RN_LOSS
		FROM (
						SELECT PLNO, RRNR_TTY_CD,
							     SUM(WNCR_CNV_PYN_BNF+RN_LTPD_OST_AMT-RN_PTRM_OST_AMT+WNCR_CNV_RN_DAG_IVMT) AS RN_LOSS
							FROM FDMTTC04002 A
							WHERE EXISTS (
									SELECT 1
										FROM FDWTAG04107 B
										WHERE B.CMSN_DVCD = '1'
									  	AND B.TTY_YR BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(:ET_PARM02, 'YYYYMMDD'),-83),'YYYY') AND SUBSTR(:ET_PARM02,1,4)
									  	AND A.RRNR_TTY_CD = B.RRNR_TTY_CD
									)
								AND CLG_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(:ET_PARM02, 'YYYYMMDD'),-11),'YYYYMM') AND SUBSTR(:ET_PARM02,1,6)
							GROUP BY PLNO, RRNR_TTY_CD
				 ) C LEFT OUTER JOIN (
						SELECT PLNO, RRNR_DAT_DVCD, RRNR_DMFR_DVCD, SUBSTR(ARC_INPL_CD,1,5) AS PDC_CD,
						  		 SUM(OGL_PYN_BNF+LTPD_OST_AMT-PTRM_OST_AMT+ACCD_IVMT) AS OGL_LOSS
						  FROM FDMTTC04001
						  WHERE CLG_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(:ET_PARM02, 'YYYYMMDD'),-11),'YYYYMM') AND SUBSTR(:ET_PARM02,1,6)
						  GROUP BY PLNO, RRNR_DAT_DVCD, RRNR_DMFR_DVCD, SUBSTR(ARC_INPL_CD,1,5)
				 ) D
			ON C.PLNO = D.PLNO
		GROUP BY D.RRNR_DAT_DVCD, D.RRNR_DMFR_DVCD, D.PDC_CD, C.RRNR_TTY_CD;

-- 일반_특약정보
SELECT RRNR_TTY_CD, TTY_CD_NM, TTY_YR
	FROM FDWTAG04107
	WHERE CMSN_DVCD = '1'
  	AND TTY_YR BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(:ET_PARM02, 'YYYYMMDD'),-83),'YYYY') AND SUBSTR(:ET_PARM02,1,4);

-- 일반_원수_손해액
SELECT SUBSTR(CLG_YM,1,4) AS FY, RRNR_DAT_DVCD, RRNR_DMFR_DVCD, ARC_INPL_CD, SUM(OGL_PYN_BNF+LTPD_OST_AMT-PTRM_OST_AMT+ACCD_IVMT) AS OGL_LOSS
	FROM FDMTTC04001
	WHERE CLG_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(:ET_PARM02, 'YYYYMMDD'),-35),'YYYYMM') AND SUBSTR(:ET_PARM02,1,6)
	GROUP BY SUBSTR(CLG_YM,1,4), RRNR_DAT_DVCD, RRNR_DMFR_DVCD, ARC_INPL_CD;

-- 일반_출재_손해액
SELECT SUBSTR(CLG_YM,1,4) AS FY, RRNR_DAT_DVCD, RRNR_DMFR_DVCD, ARC_INPL_CD, SUM(WNCR_CNV_PYN_BNF+RN_LTPD_OST_AMT-RN_PTRM_OST_AMT+WNCR_CNV_RN_DAG_IVMT) AS RN_LOSS
  FROM FDMTTC04002
  WHERE CLG_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(:ET_PARM02, 'YYYYMMDD'),-35),'YYYYMM') AND SUBSTR(:ET_PARM02,1,6)
  GROUP BY SUBSTR(CLG_YM,1,4), RRNR_DAT_DVCD, RRNR_DMFR_DVCD, ARC_INPL_CD;

-- 일반_원수_경과보험료
SELECT SUBSTR(CLG_YM,1,4) AS FY, RRNR_DAT_DVCD, RRNR_CTC_BZ_DVCD, ARC_INPL_CD, SUM(ELP_PRM) AS OGL_ELP_PRM
  FROM FDMTAG04001
  WHERE CLG_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(:ET_PARM02, 'YYYYMMDD'),-35),'YYYYMM') AND SUBSTR(:ET_PARM02,1,6)
  GROUP BY SUBSTR(CLG_YM,1,4), RRNR_DAT_DVCD, RRNR_CTC_BZ_DVCD, ARC_INPL_CD;

-- 일반_출재_경과보험료
SELECT SUBSTR(CLG_YM,1,4) AS FY, RRNR_DAT_DVCD, RRNR_CTC_BZ_DVCD, ARC_INPL_CD, SUM(T02_RN_ELP_PRM) AS RN_ELP_PRM
  FROM FDMTAG04002
  WHERE CLG_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(:ET_PARM02, 'YYYYMMDD'),-35),'YYYYMM') AND SUBSTR(:ET_PARM02,1,6)
  GROUP BY SUBSTR(CLG_YM,1,4), RRNR_DAT_DVCD, RRNR_CTC_BZ_DVCD, ARC_INPL_CD;
