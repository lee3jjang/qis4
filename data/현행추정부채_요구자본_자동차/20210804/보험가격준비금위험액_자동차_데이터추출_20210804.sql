-- 자동차_원수_미경과보험료 (2021.08.04)
SELECT /*+ FULL(A) PARALLEL(A 8) */
       BSC_CVR_CD, PDGR_CD, PDC_CD, INER_CHN_DVCD, USTK_DVCD,
       CASE WHEN EXISTS (SELECT 1 FROM FDMTAG02002 B WHERE B.PLNO = A.PLNO AND B.CLG_YM = SUBSTR(:ET_PARM02,1,6)) THEN '01' ELSE '02' END AS CMSN_DVCD,
		   SUM(LTPD_URND_PRM) AS OGL_URND_PRM
	FROM FDMTAG02001 A
  WHERE CLG_YM = SUBSTR(:ET_PARM02,1,6)
  GROUP BY BSC_CVR_CD, PDGR_CD, PDC_CD, INER_CHN_DVCD, USTK_DVCD,
           CASE WHEN EXISTS (SELECT 1 FROM FDMTAG02002 B WHERE B.PLNO = A.PLNO AND B.CLG_YM = SUBSTR(:ET_PARM02,1,6)) THEN '01' ELSE '02' END;

-- 자동차_비례출재_미경과보험료 (2021.08.04)
SELECT /*+ FULL(A) PARALLEL(A 8) */
       BSC_CVR_CD, PDGR_CD, PDC_CD, INER_CHN_DVCD, USTK_DVCD, '01' AS CMSN_DVCD,
		   SUM(RN_LTPD_URND_PRM) AS RN_URND_PRM
	FROM FDMTAG02002 A
  WHERE CLG_YM = SUBSTR(:ET_PARM02,1,6)
  GROUP BY BSC_CVR_CD, PDGR_CD, PDC_CD, INER_CHN_DVCD, USTK_DVCD;

-- 자동차_비비례출재_미경과보험료 (값 없음)
SELECT BSC_CVR_CD, PDGR_CD, PDC_CD, SL_CVR_CD, T02_RN_RINSC_CD, '02' AS CMSN_DVCD,
       SUM(LTPD_URND_PRM) AS RN_URND_PRM
	FROM FDMTAG02008
  WHERE CLG_YM = SUBSTR(:ET_PARM02,1,6)
  GROUP BY BSC_CVR_CD, PDGR_CD, PDC_CD, SL_CVR_CD, T02_RN_RINSC_CD;

-- 자동차_원수_직전1년경과보험료 (2021.08.04)
SELECT /*+ FULL(A) PARALLEL(A 8) */
       BSC_CVR_CD, PDGR_CD, PDC_CD, INER_CHN_DVCD, USTK_DVCD, NVL(B.CMSN_DVCD,'02') AS CMSN_DVCD,
		   SUM(ELP_PRM) AS OGL_ELP_PRM
	FROM FDMTAG02001 A
	LEFT OUTER JOIN (
				SELECT /*+ FULL(C) PARALLEL(C 8) */ DISTINCT PLNO, '01' AS CMSN_DVCD
					FROM FDMTAG02002 C
			) B
		ON A.PLNO = B.PLNO
  WHERE CLG_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(:ET_PARM02, 'YYYYMMDD'),-11),'YYYYMM') AND SUBSTR(:ET_PARM02,1,6)
  GROUP BY BSC_CVR_CD, PDGR_CD, PDC_CD, INER_CHN_DVCD, USTK_DVCD, NVL(B.CMSN_DVCD,'02');

-- 자동차_비례출재_직전1년경과보험료 (2021.08.04)
SELECT /*+ FULL(A) PARALLEL(A 8) */
       BSC_CVR_CD, PDGR_CD, PDC_CD, INER_CHN_DVCD, USTK_DVCD, '01' AS CMSN_DVCD,
		   SUM(RN_ELP_PRM) AS RN_ELP_PRM
	FROM FDMTAG02002 A
  WHERE CLG_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(:ET_PARM02, 'YYYYMMDD'),-11),'YYYYMM') AND SUBSTR(:ET_PARM02,1,6)
  GROUP BY BSC_CVR_CD, PDGR_CD, PDC_CD, INER_CHN_DVCD, USTK_DVCD;

-- 자동차_비비례출재_직전1년경과보험료 (2021.08.04)
SELECT /*+ FULL(A) PARALLEL(A 8) */
       BSC_CVR_CD, PDGR_CD, PDC_CD, SL_CVR_CD, T02_RN_RINSC_CD, '02' AS CMSN_DVCD,
		   SUM(ELP_PRM) AS RN_ELP_PRM
	FROM FDMTAG02008 A
  WHERE CLG_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(:ET_PARM02, 'YYYYMMDD'),-11),'YYYYMM') AND SUBSTR(:ET_PARM02,1,6)
  GROUP BY BSC_CVR_CD, PDGR_CD, PDC_CD, SL_CVR_CD, T02_RN_RINSC_CD;

-- 자동차_예정보험료 (2021.08.04)
SELECT A.PDC_CD, A.PDGR_CD, A.BSC_CVR_CD, A.USTK_DVCD, B.INER_CHN_DVCD,
       SUM(EPCT_PRM) AS OGL_EPCT_PRM,
       SUM(RN_PRM) AS RN_EPCT_PRM
	FROM FDMTAG02004 A
	LEFT OUTER JOIN (
		SELECT DISTINCT PLNO, INER_CHN_DVCD
			FROM FDMTAG02001
			WHERE CLG_YM = SUBSTR(:ET_PARM02,1,6)
	) B
		ON A.PLNO=B.PLNO
	WHERE SUBSTR(A.PYM_EPCT_DT,1,6) > A.CLG_YM
    AND A.CLG_YM = SUBSTR(:ET_PARM02,1,6)
    AND A.RPMN_YN = '0'
    GROUP BY A.PDC_CD, A.PDGR_CD, A.BSC_CVR_CD, A.USTK_DVCD, B.INER_CHN_DVCD;

-- 자동차_원수_개별추산액 (2021.08.04)
SELECT /*+ FULL(A) PARALLEL(A 8) */
       BSC_CVR_CD, PDGR_CD, PDC_CD, INER_CHN_DVCD, USTK_DVCD,
       CASE WHEN EXISTS (SELECT 1 FROM FDMTTC02002 B WHERE B.PLNO = A.PLNO AND B.CLG_YM = SUBSTR(:ET_PARM02,1,6)) THEN '01' ELSE '02' END AS CMSN_DVCD,
       SUM(LTPD_OST_BNF) AS OGL_OST_AMT
	FROM FDMTTC02001 A
  WHERE CLG_YM = SUBSTR(:ET_PARM02,1,6)
  GROUP BY BSC_CVR_CD, PDGR_CD, PDC_CD, INER_CHN_DVCD, USTK_DVCD,
           CASE WHEN EXISTS (SELECT 1 FROM FDMTTC02002 B WHERE B.PLNO = A.PLNO AND B.CLG_YM = SUBSTR(:ET_PARM02,1,6)) THEN '01' ELSE '02' END;

-- 자동차_비례출재_개별추산액 (2021.08.04)
SELECT BSC_CVR_CD, PDGR_CD, PDC_CD, INER_CHN_DVCD,
       SUM(RN_LTPD_OST_BNF) AS RN_OST_AMT
	FROM FDMTTC02002
  WHERE CLG_YM = SUBSTR(:ET_PARM02,1,6)
  GROUP BY BSC_CVR_CD, PDGR_CD, PDC_CD, INER_CHN_DVCD;

-- 자동차_비비례출재_개별추산액 (2021.08.04)
SELECT PDC_CD, T02_RN_RINSC_CD,
       SUM(WNCR_CNV_OST_RBNF) AS RN_OST_AMT
	FROM FDMTTC02004
  WHERE CLG_YM = SUBSTR(:ET_PARM02,1,6)
  GROUP BY PDC_CD, T02_RN_RINSC_CD;

-- 자동차_원수_직전3년보험금손조비 (2021.08.04)
SELECT BSC_CVR_CD, PDGR_CD, PDC_CD, INER_CHN_DVCD,
		   SUM(PYN_BNF) AS OGL_PYN_BNF,
       SUM(AT_DAG_IVMT) AS OGL_ACCD_IVMT
	FROM FDMTTC02001
  WHERE CLG_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(SUBSTR(:ET_PARM02,1,6),'YYYYMM'),-35),'YYYYMM') AND SUBSTR(:ET_PARM02,1,6)
  GROUP BY BSC_CVR_CD, PDGR_CD, PDC_CD, INER_CHN_DVCD;

-- 자동차_비례출재_직전3년보험금손조비 (2021.08.04)
SELECT BSC_CVR_CD, PDGR_CD, PDC_CD, INER_CHN_DVCD,
		   SUM(RN_PYN_BNF) AS RN_PYN_BNF,
       NVL(SUM(RN_DAG_IVMT),0) AS RN_ACCD_IVMT
	FROM FDMTTC02002
  WHERE CLG_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(SUBSTR(:ET_PARM02,1,6),'YYYYMM'),-35),'YYYYMM') AND SUBSTR(:ET_PARM02,1,6)
  GROUP BY BSC_CVR_CD, PDGR_CD, PDC_CD, INER_CHN_DVCD;

-- 자동차_비비례출재_직전3년보험금손조비 (2021.08.04)
SELECT PDC_CD,
		   SUM(WNCR_CNV_DS_RBNF-WNCR_CNV_DS_RBNF_EX_AMT) AS RN_PYN_BNF,
       SUM(WNCR_CNV_DAG_INV_CS) AS RN_ACCD_IVMT
	FROM FDMTTC02004
  WHERE CLG_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(SUBSTR(:ET_PARM02,1,6),'YYYYMM'),-35),'YYYYMM') AND SUBSTR(:ET_PARM02,1,6)
  GROUP BY PDC_CD;

-- 자동차_IBNR
SELECT RRNR_DVCD, BSC_CVR_CD,
       SUM(KRW_OS_AMT_E) AS KRW_OS_AMT_E
	FROM (
	SELECT TO_CHAR(AS_OF_DATE,'YYYYMM') AS CLG_YM
	     , CASE WHEN FUND_TYP_CD='10' THEN '01'
	            WHEN FUND_TYP_CD='11' THEN '02'
	            WHEN FUND_TYP_CD='12' THEN '03' END AS RRNR_DVCD
	     , SUBSTR(FCONT_ID,5,2) AS BSC_CVR_CD
	     , KRW_OS_AMT_E
	  FROM Q_CB_INST_NLA_LIC_IBNR
	  WHERE TO_CHAR(AS_OF_DATE,'YYYYMM') = SUBSTR(:ET_PARM02,1,6)
	)
	GROUP BY RRNR_DVCD, BSC_CVR_CD;

-- 자동차_보험금진전추이
-- ※ SQNO 여러개 아닌지 확인 후 뽑을 것!
SELECT PDGR_CD, AY, BASE_1,BASE_2, BASE_3, BASE_4, BASE_5, BASE_6, BASE_7
	FROM KICS_RISK_CF_NL_C
	WHERE BSE_YM = SUBSTR(:ET_PARM02,1,6)
		AND SQNO = '6';

-- 자동차_최종손해율
-- ※ SQNO 여러개 아닌지 확인 후 뽑을 것!
SELECT RRNR_DAT_DVCD, AT_CHN_DVCD, AT_PDGR_CD, FNAL_LSRT
	FROM FBMTST13201
  WHERE BSE_YM = SUBSTR(:ET_PARM02,1,6)
  	AND SQNO = '1'
    AND BSE_MON_DVCD = '12';

-- 자동차_사업비율
SELECT DISTINCT RRNR_DVCD, BOZ_CD, EXP_RT
	FROM KICS_PRM_RPT
	WHERE TO_CHAR(BASE_DATE,'YYYYMM') = SUBSTR(:ET_PARM02,1,6)
		AND SUBSTR(BOZ_CD, 0, 1) = 'B';

-- 자동차_코드맵핑
SELECT PDC_CD, PDGR_CD, BSC_CVR_CD, INER_CHN_DVCD, USTK_DVCD, AT_PDGR_CD, AT_BSC_CVR_CD, AT_CHN_DVCD
	FROM Q_NLA_CONV_CODE_MAPS
	WHERE APLY_END_DATE = '99991231';